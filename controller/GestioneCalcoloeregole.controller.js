sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/m/TabContainerItem","sap/m/MessageBox","sap/m/library","sap/ui/core/library","sap/ui/core/Core","vodafone/RepintHRAdmin/util/Formatter","sap/ui/core/format/DateFormat"],function(e,t,a,o,s,i,r,l,n,I,d){"use strict";var g=r.TimePickerMaskMode,c=l.ValueState;return e.extend("vodafone.RepintHRAdmin.controller.GestioneCalcoloeregole",{onInit:function(){var e=this;e._busyDialog=new sap.m.BusyDialog({showCancelButton:false});var t=new o;this.getView().setModel(t,"oRogoleBloccoModel");e.byId("TP1").setMaskMode(g.On);e.byId("TP2").setMaskMode(g.On);var e=this;var a=[];var s=e.getOwnerComponent().getModel("basexsoModel");s.read("/DATAFROMSF",{success:function(t,s){for(var i=0;i<t.results.length;i++){a.push(t.results[i].LIVELLO)}a=a.filter(function(e,t,a){return a.indexOf(e)==t});var r=[];for(var l=0;l<a.length;l++){var n={LIVELLO:a[l]};r.push(n)}console.log("Data Loded");var I=new o(r);e.getView().byId("idLivelloCollection").setModel(I,"livelloModel");e.getView().byId("idLivelloCollectionLPN").setModel(I,"livelloModel");e.getView().byId("idLivelloCollectionImp").setModel(I,"livelloModel1");e.getView().byId("idLivelloRegoleBloccoData").setModel(I,"livelloModel1");e.getView().byId("idLivelloRegoleBlocco").setModel(I,"livelloModel1")},error:function(e){console.log("Error")}});var e=this;var s=e.getOwnerComponent().getModel("basexsoModel");s.read("/TIPOGIORNO",{success:function(t,a){console.log("Data Loded");var o=new sap.ui.model.json.JSONModel(t.results);e.getView().byId("idTipoCollection").setModel(o,"TipooModel");var s=[];var i={IDTIPOGIORNO:"F",TIPOGIORNO_DESC:"Festivi e Domenica"};s.push(i);var r={IDTIPOGIORNO:"L",TIPOGIORNO_DESC:"Lunedì-Venerdì non festivi"};s.push(r);var l={IDTIPOGIORNO:"S",TIPOGIORNO_DESC:"Sabato"};s.push(l);var n=new sap.ui.model.json.JSONModel(s);e.getView().byId("idTipoCollectionImp").setModel(n,"TipooModel2");e.getView().byId("idTipoCollectionImp7").setModel(o,"TipooModel1")},error:function(e){console.log("Error")}});var i={SelectedMinima:0,MinimaCollection:[{MinimaId:0,Value:0},{MinimaId:1,Value:1},{MinimaId:2,Value:2},{MinimaId:3,Value:3},{MinimaId:4,Value:4},{MinimaId:5,Value:5},{MinimaId:6,Value:6},{MinimaId:7,Value:7},{MinimaId:8,Value:8},{MinimaId:9,Value:9},{MinimaId:10,Value:10},{MinimaId:11,Value:11},{MinimaId:12,Value:12},{MinimaId:13,Value:13},{MinimaId:14,Value:14},{MinimaId:15,Value:15},{MinimaId:16,Value:16},{MinimaId:17,Value:17},{MinimaId:18,Value:18},{MinimaId:19,Value:19},{MinimaId:20,Value:20},{MinimaId:21,Value:21},{MinimaId:22,Value:22},{MinimaId:23,Value:23},{MinimaId:24,Value:24}]};var r=new o(i);e.getView().byId("idDurataMinima").setModel(r,"minimaoModel");e.getView().byId("idDurataMinima1").setModel(r,"minimaoModel");var l={SelectedMassima:1,MassimaCollection:[{MassimaId:1,Value:1},{MassimaId:2,Value:2},{MassimaId:3,Value:3},{MassimaId:4,Value:4},{MassimaId:5,Value:5},{MassimaId:6,Value:6},{MassimaId:7,Value:7},{MassimaId:8,Value:8},{MassimaId:9,Value:9},{MassimaId:10,Value:11},{MassimaId:12,Value:12},{MassimaId:13,Value:13},{MassimaId:14,Value:14},{MassimaId:15,Value:15},{MassimaId:16,Value:16},{MassimaId:17,Value:17},{MassimaId:18,Value:18},{MassimaId:19,Value:19},{MassimaId:20,Value:20},{MassimaId:21,Value:21},{MassimaId:22,Value:22},{MassimaId:23,Value:23},{MassimaId:24,Value:24}]};var I=new o(l);e.getView().byId("idDurataMassima").setModel(I,"massimaoModel");e.getView().byId("idDurataMassima1").setModel(I,"massimaoModel");n.attachParseError(function(e){var t=e.getParameter("element");if(t.setValueState){t.setValueState(c.Error)}});n.attachValidationSuccess(function(e){var t=e.getParameter("element");if(t.setValueState){t.setValueState(c.None)}})},onPressRepintHome:function(e){var t=new sap.m.BusyDialog;t.open();sap.m.URLHelper.redirect("https://repint-bfmyao56da.dispatcher.hana.ondemand.com",false);t.close()},onAddImpIntItem:function(e){var t=this;if(t.getView().byId("idTableImpIntData").getModel("ImpIntDataModel")===undefined){var s=t.getView().byId("idTableImpInv");t.mainData={ImportIInterCollection:[{IDTIPOGIORNO:s.getItems()[0].getCells()[0].getSelectedItem().getText(),ORAINIZIO:s.getItems()[0].getCells()[1].getValue(),ORAFINE:s.getItems()[0].getCells()[2].getValue(),VALORE:s.getItems()[0].getCells()[3].getValue(),LIVELLO:s.getItems()[0].getCells()[4].getSelectedItem().getText(),oEdit:true,oDelete:true}]};t.oModelImpIntData=new o(t.mainData);t.getView().byId("idTableImpIntData").setModel(t.oModelImpIntData,"ImpIntDataModel")}else{var r=t.getView().byId("idTableImpIntData").getModel("ImpIntDataModel").getProperty("/");var s=t.getView().byId("idTableImpInv");var l={IDTIPOGIORNO:s.getItems()[0].getCells()[0].getSelectedItem().getText(),ORAINIZIO:s.getItems()[0].getCells()[1].getValue(),ORAFINE:s.getItems()[0].getCells()[2].getValue(),VALORE:s.getItems()[0].getCells()[3].getValue(),LIVELLO:s.getItems()[0].getCells()[4].getSelectedItem().getText(),oEdit:true,oDelete:true};r.push(l);t.getView().byId("idTableImpIntData").getModel("ImpIntDataModel").setProperty("/",r);var n=t.getOwnerComponent().getModel("basexsoModel");if(s.getItems()[0].getCells()[1].getValue()){var d=s.getItems()[0].getCells()[1].getValue();var g=d.split(":")[0];var c=d.split(":")[1]}else{var g=0;var c=0}if(s.getItems()[0].getCells()[2].getValue()){var u=s.getItems()[0].getCells()[2].getValue();var m=u.split(":")[0];var M=u.split(":")[1]}else{var m=0;var M=0}t.getImportiInterventiSet(n);var D={IDIMPORTIINTERVENTO:t.dataGenerate+1,IDTIPOGIORNO:s.getItems()[0].getCells()[0].getSelectedItem().getKey(),ORA_INI:g,MIN_INI:c,ORA_FINE:m,MIN_FINE:M,VALORE:s.getItems()[0].getCells()[3].getValue(),LIVELLO:s.getItems()[0].getCells()[4].getSelectedItem().getText(),ORAINIZIO:I.checkTime(s.getItems()[0].getCells()[1].getValue()),ORAFINE:I.checkTime(s.getItems()[0].getCells()[2].getValue())};n.create("/IMPORTIINTERVENTI2018",D,{success:function(e,o){a.show("Record successfully added");t.getImportiInterventiSet(n)}.bind(t),error:function(e){i.error("Impossibile salvare. Contatta l'amministratore")}.bind(t)})}},handleAnnoMeseChange:function(e){console.log(e);var t=this;var a=e.getSource().getDateValue();var o=new Date(a.getFullYear(),a.getMonth()+1,1);var s=new Date(a.getFullYear(),a.getMonth()+2,0);t.getView().byId("idDipendenteDate").setMinDate(s);t.getView().byId("idDipendenteDate").setMaxDate(o);t.getView().byId("idResponsabile").setMinDate(s);t.getView().byId("idResponsabile").setMaxDate(o);t.getView().byId("idHRDateProcesso").setMinDate(s);t.getView().byId("idHRDateProcesso").setMaxDate(o);t.getView().byId("idInvioFlussiAuto").setMinDate(s);t.getView().byId("idInvioFlussiAuto").setMaxDate(o)},onAddFestiviItem:function(){var e=this;var t=e.getView().byId("idTableFestivita");var o=e.getView().byId("idMeseGiorni").getValue();if(o!==""&&o!==undefined&&o!==null){var s={DESCRIZIONE:t.getItems()[0].getCells()[1].getValue(),MMGG:o};var r=e.getView().getModel("FestiviModel").getData();var l=jQuery.grep(r,function(e){return e.MMGG==o});if(l.length>0){i.error("Data già presente, selezionarne un'altra.")}else{var n=e.getOwnerComponent().getModel("basexsoModel");var I=[];n.attachRequestSent(function(){e._busyDialog.open()});n.attachRequestCompleted(function(){e._busyDialog.close()});var d=new sap.ui.model.json.JSONModel;n.create("/FESTIVISET",s,{success:function(t,o){e.getView().byId("idMeseGiorni").setValue("");e.getView().byId("idDescrizione").setValue("");e.getFestiviSet(n);a.show("Festività salvata con successo")}.bind(e),error:function(e){i.error("Impossibile salvare. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Aggiungi failed for FESTIVISET. Please contact administrator."+e.toString())}.bind(e)})}}else{i.error("Mese Giorni cannot be blank")}},onEdit:function(e){var t=this;var a=e.getSource().getParent();var o=t.getView().byId("idTableImpIntData");var s=o.indexOfItem(a);var i=o.getModel("ImpIntDataModel").getObject("/ImportIInterCollection")[s];if(i){var r=o.getItems()[s];t.onPress(r,false);var l=o.getItems()[s];if(e.getSource().getPressed()){t.onPress(l,true)}else{t.onPress(l,false)}}},onEditFestivi:function(e){var t=this;t.tt=e.getSource().getParent();var a=t.getView().byId("idTableFestivitaData");var o=a.indexOfItem(t.tt);var s=a.getModel("FestiviModel").getObject("/")[o];if(s){var r=a.getItems()[o];t.onPress(r,false);var l=a.getItems()[o];if(e.getSource().getPressed()){t.onPress(l,true);this.oldData=JSON.stringify(s)}else{t.onPress(l,false);var n=e.getSource().getBindingContext("FestiviModel").getObject();if(n.MMGG!==""&&n.MMGG!==undefined&&n.MMGG!==null){var I=t.getOwnerComponent().getModel("basexsoModel");I.attachRequestSent(function(){t._busyDialog.open()});I.attachRequestCompleted(function(){t._busyDialog.close()});var d=JSON.parse(this.oldData);var g={MMGG:d.MMGG,MMGG_NEW:n.MMGG,DESCRIZIONE:d.DESCRIZIONE,DESCRIZIONE_NEW:n.DESCRIZIONE};var c={Object:{Header:g}};var u="/HANAMDC/REPINT/RepintAdmin/xsodata/RepintAdmin.xsodata";var m="/HANAMDC/REPINT/RepintAdmin/xsjs/updateAdmin.xsjs";$.ajax({url:u+"/",type:"GET",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,a,o){var s=o.getResponseHeader("X-CSRF-Token");$.ajax({url:m,type:"POST",contentType:"application/json",data:JSON.stringify(c),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",s)},success:function(e,a,o){console.log("Insert Success");console.log(a);if(e.toString().includes("Error")){i.error("Data già presente, selezionarne un'altra.")}else{i.success("Festività salvata con successo");t.getFestiviSet(I)}},error:function(e,t,a){i.error("Impossibile salvare. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Modifica failed for Festivita. Please contact administrator."+oError.toString());console.log(t)}})}})}}}},onPress:function(e,t){var a=e.getCells();for(var o=0;o<a.length-2;o++){var s=a[o];var i=s.getMetadata();var r=i.getElementName();if(r==="sap.m.Input"||r==="sap.m.DatePicker"||r==="sap.m.CheckBox"||r==="sap.m.Select"){s.setEnabled(t);s.setEditable(t)}}},onPressAfterMoifica:function(e,t){var a=e.getCells();for(var o=0;o<a.length-2;o++){var s=a[o];var i=s.getMetadata();var r=i.getElementName();if(r==="sap.m.Input"||r==="sap.m.DatePicker"||r==="sap.m.CheckBox"||r==="sap.m.Select"){s.setEnabled(t);s.setEditable(t)}}},onPressDateProcesso:function(){var e=this;var t;var a;var o=e.getView().byId("idTableDateProcessoData");if(e.getView().getModel("DatediprocessoModel")!==undefined||e.getView().getModel("DatediprocessoModel")===null){if(e.getView().getModel("DatediprocessoModel").getData().length>0){t=e.getView().getModel("DatediprocessoModel").getData();a=t[t.length-1].IDDATAPROCESSO}else if(e.getView().getModel("DatediprocessoModel").getData().length===0){a=0}}if(e.getView().byId("idmeseanno").getDateValue()===null){i.error("Il campo Mese / Anno deve essere valorizzato");return}else if(e.getView().byId("idDipendenteDate").getDateValue()===null){i.error("Il campo Dipendente deve essere valorizzato");return}else if(e.getView().byId("idResponsabile").getDateValue()===null){i.error("Il campo Responsabile deve essere valorizzato");return}else if(e.getView().byId("idHRDateProcesso").getDateValue()===null){i.error("Il campo HR deve essere valorizzato");return}else if(e.getView().byId("idInvioFlussiAuto").getDateValue()===null){i.error('In campo "Flussi Automatici" non può essere vuoto');return}var s=e.getView().byId("idmeseanno").getDateValue();var r=e.getView().byId("idDipendenteDate").getDateValue().getFullYear()+"-"+I.formatDate(e.getView().byId("idDipendenteDate").getDateValue())+"T00:00:00";var l=e.getView().byId("idResponsabile").getDateValue().getFullYear()+"-"+I.formatDate(e.getView().byId("idResponsabile").getDateValue())+"T00:00:00";var n=e.getView().byId("idHRDateProcesso").getDateValue().getFullYear()+"-"+I.formatDate(e.getView().byId("idHRDateProcesso").getDateValue())+"T00:00:00";var d=e.getView().byId("idInvioFlussiAuto").getDateValue().getFullYear()+"-"+I.formatDate(e.getView().byId("idInvioFlussiAuto").getDateValue())+"T00:00:00";s=s.getFullYear()+"-"+I.formatDate(e.getView().byId("idmeseanno").getDateValue())+"T00:00:00";var g=new Date;var c=new Date;var u={IDDATAPROCESSO:"",MESEANNO:s,DIPENDENTE:r,RESPONSABILE:l,HR:n,INVIO_FLUSSI:d,BP:g,AMMINISTRAZIONE:c};var m=u.MESEANNO.split("-");u.MESEANNO=m[0]+"-"+m[1]+"-"+"01T00:00:00";var M={Object:{Header:u}};var D=e.getOwnerComponent().getModel("basexsoModel");D.attachRequestSent(function(){e._busyDialog.open()});D.attachRequestCompleted(function(){e._busyDialog.close()});var p="/HANAMDC/REPINT/RepintAdmin/xsodata/RepintAdmin.xsodata";var v="/HANAMDC/REPINT/RepintAdmin/xsjs/insertDateProcesso.xsjs";$.ajax({url:p+"/",type:"GET",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(t,a,o){var s=o.getResponseHeader("X-CSRF-Token");$.ajax({url:v,type:"POST",contentType:"application/json",data:JSON.stringify(M),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",s)},success:function(t,a,o){console.log("Insert Success");console.log(a);i.success("Date di processo salvata con successo");e.getView().byId("idmeseanno").setValue("");e.getView().byId("idDipendenteDate").setValue("");e.getView().byId("idResponsabile").setValue("");e.getView().byId("idHRDateProcesso").setValue("");e.getView().byId("idInvioFlussiAuto").setValue("");e.getDateDiProcessoSet(D)},error:function(e,t,a){i.error("Impossibile salvare. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Inserisci failed for Date Processo. Please contact administrator."+oError.toString());console.log(t)}})}})},onEditDatediprocesso:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idTableDateProcessoData");var r=s.indexOfItem(o);var l=s.getModel("DatediprocessoModel").getObject("/")[r];if(l){var n=s.getItems()[r];t.onPress(n,false);var I=s.getItems()[r];if(e.getSource().getPressed()){t.onPress(I,true)}else{t.onPress(I,false);var d=t.getOwnerComponent().getModel("basexsoModel");var o=e.getSource().getBindingContext("DatediprocessoModel").getObject();if(o.MESEANNO.split("-")[0].length==2){var g=o.MESEANNO.split("-")[2]+"-"+o.MESEANNO.split("-")[1]+"-"+o.MESEANNO.split("-")[0]+"T00:00:00"}else{var g=o.MESEANNO+"T00:00:00"}if(o.DIPENDENTE.split("-")[0].length==2){var c=o.DIPENDENTE.split("-")[2]+"-"+o.DIPENDENTE.split("-")[1]+"-"+o.DIPENDENTE.split("-")[0]+"T00:00:00"}else{var c=o.DIPENDENTE+"T00:00:00"}if(o.RESPONSABILE.split("-")[0].length==2){var u=o.RESPONSABILE.split("-")[2]+"-"+o.RESPONSABILE.split("-")[1]+"-"+o.RESPONSABILE.split("-")[0]+"T00:00:00"}else{var u=o.RESPONSABILE+"T00:00:00"}if(o.HR.split("-")[0].length==2){var m=o.HR.split("-")[2]+"-"+o.HR.split("-")[1]+"-"+o.HR.split("-")[0]+"T00:00:00"}else{var m=o.HR+"T00:00:00"}if(o.INVIO_FLUSSI.split("-")[0].length==2){var M=o.INVIO_FLUSSI.split("-")[2]+"-"+o.INVIO_FLUSSI.split("-")[1]+"-"+o.INVIO_FLUSSI.split("-")[0]+"T00:00:00"}else{var M=o.INVIO_FLUSSI+"T00:00:00"}var D;var p;if(l.BP==""){D=new Date}else{D=o.BP.split("-")[2]+"-"+o.BP.split("-")[1]+"-"+o.BP.split("-")[0]+"T00:00:00"}if(l.AMMINISTRAZIONE==""){p=new Date}else{p=o.AMMINISTRAZIONE.split("-")[2]+"-"+o.AMMINISTRAZIONE.split("-")[1]+"-"+o.AMMINISTRAZIONE.split("-")[0]+"T00:00:00"}var v={IDDATAPROCESSO:l.IDDATAPROCESSO,MESEANNO:g,DIPENDENTE:c,RESPONSABILE:u,HR:m,INVIO_FLUSSI:M,BP:D,AMMINISTRAZIONE:p};var O={Object:{Header:v}};d.attachRequestSent(function(){t._busyDialog.open()});d.attachRequestCompleted(function(){t._busyDialog.close()});var T="/HANAMDC/REPINT/RepintAdmin/xsodata/RepintAdmin.xsodata";var R="/HANAMDC/REPINT/RepintAdmin/xsjs/updateDateProcesso.xsjs";$.ajax({url:T+"/",type:"GET",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,o,s){var r=s.getResponseHeader("X-CSRF-Token");$.ajax({url:R,type:"POST",contentType:"application/json",data:JSON.stringify(O),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",r)},success:function(e,o,s){console.log("Insert Success");console.log(o);a.show("Data di Processo salvata con successo");t.getDateDiProcessoSet(d)},error:function(e,t,a){i.error("Impossibile salvare. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Modifica failed for Date Processo. Please contact administrator."+oError.toString());console.log(t)}})}})}}},onDeleteDatediprocesso:function(e){var t=this;var o=t.getOwnerComponent().getModel("basexsoModel");var s=e.getSource().getBindingContext("DatediprocessoModel").getObject();o.attachRequestSent(function(){t._busyDialog.open()});o.attachRequestCompleted(function(){t._busyDialog.close()});o.remove("/DATEDIPROCESSO("+s.IDDATAPROCESSO+")",{success:function(e,s){console.log("DATEDIPROCESSO Delete Success");a.show("Data di Processo cancellata con successo");t.getDateDiProcessoSet(o)}.bind(t),error:function(e){i.error("Impossibile salvare. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Elimina failed for Date Processo. Please contact administrator."+e.toString())}.bind(t)})},handleDateProcessoAnnoMeseChange:function(e){var t=this;var a=t.getView().byId("idTableDateProcessoData").indexOfItem(e.getSource().getParent());var o=t.getView().byId("idTableDateProcessoData").getModel("DatediprocessoModel").getProperty("/");o[a].MESEANNO=I.formatDatediprocessoDate(e.getSource().getDateValue());t.getView().byId("idTableDateProcessoData").getModel("DatediprocessoModel").setProperty("/",o)},handleDateProcessoDipendenteChange:function(e){var t=this;var a=t.getView().byId("idTableDateProcessoData").indexOfItem(e.getSource().getParent());var o=t.getView().byId("idTableDateProcessoData").getModel("DatediprocessoModel").getProperty("/");o[a].DIPENDENTE=I.formatDatediprocessoDate(e.getSource().getDateValue());t.getView().byId("idTableDateProcessoData").getModel("DatediprocessoModel").setProperty("/",o)},handleDateProcessoResponsabileChange:function(e){var t=this;var a=t.getView().byId("idTableDateProcessoData").indexOfItem(e.getSource().getParent());var o=t.getView().byId("idTableDateProcessoData").getModel("DatediprocessoModel").getProperty("/");o[a].RESPONSABILE=I.formatDatediprocessoDate(e.getSource().getDateValue());t.getView().byId("idTableDateProcessoData").getModel("DatediprocessoModel").setProperty("/",o)},handleDateProcessoHRChange:function(e){var t=this;var a=t.getView().byId("idTableDateProcessoData").indexOfItem(e.getSource().getParent());var o=t.getView().byId("idTableDateProcessoData").getModel("DatediprocessoModel").getProperty("/");o[a].HR=I.formatDatediprocessoDate(e.getSource().getDateValue());t.getView().byId("idTableDateProcessoData").getModel("DatediprocessoModel").setProperty("/",o)},handleDateProcessoInvFluChange:function(e){var t=this;var a=t.getView().byId("idTableDateProcessoData").indexOfItem(e.getSource().getParent());var o=t.getView().byId("idTableDateProcessoData").getModel("DatediprocessoModel").getProperty("/");o[a].INVIO_FLUSSI=I.formatDatediprocessoDate(e.getSource().getDateValue());t.getView().byId("idTableDateProcessoData").getModel("DatediprocessoModel").setProperty("/",o)},handleFestiviMeseGiorniOldDate:function(e){console.log(e);if(e.getSource().getValue()!==""&&e.getSource().getValue()!==null){this.getOwnerComponent().getModel("viewProperties").setProperty("/oldFestiviMeseGiorniDate",e.getSource().getValue().split("-")[1]+"-"+e.getSource().getValue().split("-")[0])}else{this.getOwnerComponent().getModel("viewProperties").setProperty("/oldFestiviMeseGiorniDate",null)}},handleFestiviMeseGiorniDate:function(e){console.log(e);var t=this;var a=t.getView().byId("idTableFestivitaData").indexOfItem(e.getSource().getParent());var o=t.getView().byId("idTableFestivitaData").getModel("FestiviModel").getProperty("/");o[a].MMGG=I.formatDate(e.getSource().getDateValue());t.getView().byId("idTableFestivitaData").getModel("FestiviModel").setProperty("/",o)},onDeleteFestivi:function(e){var t=this;var o=t.getOwnerComponent().getModel("basexsoModel");var s=e.getSource().getBindingContext("FestiviModel").getObject();o.attachRequestSent(function(){t._busyDialog.open()});o.attachRequestCompleted(function(){t._busyDialog.close()});o.remove("/FESTIVISET('"+s.MMGG+"')",{success:function(e,s){console.log(" FestiviSet Delete Success");t.getFestiviSet(o);a.show("Festività cancellata con successo")}.bind(t),error:function(e){i.error("Elimina failed for FestiviSet. Please contact administrator.");jQuery.sap.log.getLogger().error("Elimina failed for FestiviSet. Please contact administrator."+e.toString())}.bind(t)})},handleChange:function(e){var t=e.getSource(),a=e.getParameter("value"),o=e.getParameter("valid");if(o){t.setValueState(c.None)}else{t.setValueState(c.Error)}},_onObjectMatched:function(e){},handleBack:function(e){var a=this;var o=t.getInstance().getPreviousHash();if(o!==undefined){history.go(-1)}else{a.getOwnerComponent().getRouter().navTo("object")}},onAfterRendering:function(){var e=this;var t=e.getOwnerComponent().getModel("basexsoModel");e.getFestiviSet(t);e.getStabilimentiSet(t);e.getDateDiProcessoSet(t);e.getImportiInterventiSet(t);e.getImportiInterventiLPNSet(t);e.getImportiRep(t);e.getRegole(t);e.getRegoleBlocco(t);e.getRegoleCompensativeMultipli(t)},getFestiviSet:function(e){var t=this;var a=new sap.ui.model.json.JSONModel;var o=[];e.attachRequestSent(function(){t._busyDialog.open()});e.attachRequestCompleted(function(){t._busyDialog.close()});var s=[];e.read("/FESTIVISET",{success:function(e,o){console.log(" FestiviSet");console.log(e.results);a.setData(e.results);a.refresh();a.updateBindings(true);t.getView().setModel(a,"FestiviModel")}.bind(t),error:function(e){i.error("Impossibile ottenere le informazioni per il calcolo delle festività. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed for FestiviSet. Please contact administrator."+e.toString())}.bind(t)})},getStabilimentiSet:function(e){var t=this;var a=new sap.ui.model.json.JSONModel;e.attachRequestSent(function(){t._busyDialog.open()});e.attachRequestCompleted(function(){t._busyDialog.close()});e.read("/STABILIMENTISET",{success:function(e,o){console.log(" StabilimentiSet");console.log(e.results);a.setData(e.results);t.getView().setModel(a,"StabilimentiModel")}.bind(t),error:function(e){i.error("Data fetch failed for Santo Patrono. Please contact administrator.");jQuery.sap.log.getLogger().error("Data fetch failed for Santo Patrono. Please contact administrator."+e.toString())}.bind(t)})},onAddImpIntlpnItem:function(e){var t=this;if(t.getView().byId("idTableInterLPN").getModel("ImpIntLPNDataModel")===undefined){var s=t.getView().byId("idTableInterLPN");t.mainData={ImportIInterCollection:[{TipoGiorno:s.getItems()[0].getCells()[0].getSelectedItem().getText(),OraInizio:s.getItems()[0].getCells()[1].getSelectedItem().getText(),Valore:s.getItems()[0].getCells()[2].getValue(),Livello:s.getItems()[0].getCells()[3].getSelectedItem().getText(),oEdit:true,oDelete:true}]};t.oModelImpIntData=new o(t.mainData);t.getView().byId("idTableInterLPN").setModel(t.oModelImpIntData,"ImpIntDataModel")}else{var r=t.getView().byId("idTableImpIntData").getModel("ImpIntDataModel").getProperty("/ImportIInterCollection");var s=t.getView().byId("idTableImpInv");var l={TipoGiorno:s.getItems()[0].getCells()[0].getSelectedItem().getText(),OraInizio:s.getItems()[0].getCells()[1].getValue(),Orafine:s.getItems()[0].getCells()[2].getValue(),Valore:s.getItems()[0].getCells()[3].getValue(),Livello:s.getItems()[0].getCells()[4].getSelectedItem().getText(),oEdit:true,oDelete:true};r.push(l);t.getView().byId("idTableImpIntData").getModel("ImpIntDataModel").setProperty("/ImportIInterCollection",r);var n=t.getOwnerComponent().getModel("basexsoModel");n.create("/IMPORTIINTERVENTI2018",l,{success:function(e,t){a.show("Importi Interventi Record successfully added")}.bind(t),error:function(e){i.error("Aggiungi failed for Importi Interventi. Please contact administrator.")}.bind(t)})}},getDateDiProcessoSet:function(e){var t=this;var a=new sap.ui.model.json.JSONModel;var o=[];var s={};e.attachRequestSent(function(){t._busyDialog.open()});e.attachRequestCompleted(function(){t._busyDialog.close()});e.read("/DATEDIPROCESSO",{success:function(e,i){console.log(" DatediprocessoSet");console.log(e.results);e.results.sort(function(e,t){var a=e.MESEANNO;var o=t.MESEANNO;if(a<o){return 1}else if(a==o){return 0}else{return-1}});for(var r=0;r<e.results.length;++r){s={IDDATAPROCESSO:e.results[r].IDDATAPROCESSO,MESEANNO:I.formatReadDate(e.results[r].MESEANNO),DIPENDENTE:I.formatReadDate(e.results[r].DIPENDENTE),RESPONSABILE:I.formatReadDate(e.results[r].RESPONSABILE),HR:I.formatReadDate(e.results[r].HR),INVIO_FLUSSI:I.formatReadDate(e.results[r].INVIO_FLUSSI),BP:I.formatReadDate(e.results[r].BP),AMMINISTRAZIONE:I.formatReadDate(e.results[r].AMMINISTRAZIONE)};o.push(s);s={}}a.setData(o);t.getView().setModel(a,"DatediprocessoModel")}.bind(t),error:function(e){i.error("Impossibile ottenere le informazioni necessarie per inviare la scheda in approvazione o in rifiuto. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed for Date Processo. Please contact administrator."+e.toString())}.bind(t)})},getImportiInterventiSet:function(e){var t=new sap.ui.model.json.JSONModel;var a=this;e.read("/IMPORTIINTERVENTI2018",{success:function(e,o){console.log("Data Loded");a.dataGenerate=e.results[e.results.length-1].IDIMPORTIINTERVENTO;t.setData(e.results);a.getView().setModel(t,"ImpIntDataModel")}.bind(a),error:function(e){console.log("Error")}.bind(a)})},onEditImpInt:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idTableImpIntData");var r=s.indexOfItem(o);var l=s.getModel("ImpIntDataModel").getObject("/")[r];var n=t.getOwnerComponent().getModel("basexsoModel");if(l){var I=s.getItems()[r];t.onPress(I,false);var d=s.getItems()[r];if(e.getSource().getPressed()){t.onPress(d,true)}else{t.onPress(d,false);n.update("/IMPORTIINTERVENTI2018("+l.IDIMPORTIINTERVENTO+")",l,{success:function(e,t){a.show("Record successfully updated")}.bind(t),error:function(e){i.error("Impossibile salvare. Contatta l'amministratore")}.bind(t)})}}},onDeleteImpInt:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idTableImpIntData");var r=s.indexOfItem(o);var l=s.getModel("ImpIntDataModel").getObject("/")[r];var n=t.getOwnerComponent().getModel("basexsoModel");n.remove("/IMPORTIINTERVENTI2018("+l.IDIMPORTIINTERVENTO+")",{success:function(e,o){a.show("Record successfully deleted");t.getImportiInterventiSet(n)}.bind(t),error:function(e){i.error("Impossibile salvare. Contatta l'amministratore")}.bind(t)})},getImportiInterventiLPNSet:function(e){var t=new sap.ui.model.json.JSONModel;var a=this;e.read("/IMPORTIINTERVENTILPN",{success:function(e,o){console.log("Data Loded");a.dataGeneratLPN=e.results[e.results.length-1].IDIMPORTIINTERVENTO_LPN;var s=[];var i={};for(var r=0;r<e.results.length;++r){i={IDIMPORTIINTERVENTO_LPN:e.results[r].IDIMPORTIINTERVENTO_LPN,DURATA_MIN:e.results[r].DURATA_MIN,DURATA_MAX:e.results[r].DURATA_MAX,VALORE:e.results[r].VALORE,LIVELLO:e.results[r].LIVELLO,MIN_DURATA_MIN:e.results[r].MIN_DURATA_MIN,MIN_DURATA_MAX:e.results[r].MIN_DURATA_MAX,oEdit:true,oDelete:true};s.push(i);i={}}t.setData(s);a.getView().setModel(t,"ImpIntLPNDataModel")}.bind(a),error:function(e){console.log("Error")}.bind(a)})},onAddImpIntlpnItem:function(e){var t=this;if(t.getView().byId("idTableInterLPN1").getModel("ImpIntLPNDataModel")===undefined){var s=t.getView().byId("idTableInterLPN1");t.mainData={ImportIInterCollection:[{IDIMPORTIINTERVENTO_LPN:s.getItems()[0].getCells()[0].getValue(),DURATA_MIN:s.getItems()[0].getCells()[0].getSelectedItem().getText(),DURATA_MAX:s.getItems()[0].getCells()[1].getSelectedItem().getText(),VALORE:s.getItems()[0].getCells()[2].getValue(),LIVELLO:s.getItems()[0].getCells()[3].getSelectedItem().getText(),MIN_DURATA_MIN:s.getItems()[0].getCells()[0].getSelectedItem().getText()*60,MIN_DURATA_MAX:s.getItems()[0].getCells()[1].getSelectedItem().getText()*60,oEdit:true,oDelete:true}]};t.oModelImpIntData=new o(t.mainData);t.getView().byId("idTableInterLPN1").setModel(t.oModelImpIntData,"ImpIntLPNDataModel")}else{var r=t.getView().byId("idTableInterLPN1").getModel("ImpIntLPNDataModel").getProperty("/");var l=t.getOwnerComponent().getModel("basexsoModel");var s=t.getView().byId("idTableInterLPN1");t.getImportiInterventiLPNSet(l);var n={IDIMPORTIINTERVENTO_LPN:t.dataGeneratLPN+1,DURATA_MIN:parseInt(s.getItems()[0].getCells()[0].getSelectedItem().getText()),DURATA_MAX:parseInt(s.getItems()[0].getCells()[1].getSelectedItem().getText()),VALORE:s.getItems()[0].getCells()[2].getValue(),LIVELLO:s.getItems()[0].getCells()[3].getSelectedItem().getText(),MIN_DURATA_MIN:parseInt(s.getItems()[0].getCells()[0].getSelectedItem().getText()*60),MIN_DURATA_MAX:parseInt(s.getItems()[0].getCells()[1].getSelectedItem().getText()*60)};r.push(n);t.getView().byId("idTableInterLPN1").getModel("ImpIntLPNDataModel").setProperty("/",r);l.create("/IMPORTIINTERVENTILPN",n,{success:function(e,o){a.show("Importi Interventi Record successfully added");t.getImportiInterventiLPNSet(l)}.bind(t),error:function(e){i.error("Aggiungi failed for Importi Interventi. Please contact administrator.")}.bind(t)})}},onEditLPN:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idTableLPNIntData1");var r=s.indexOfItem(o);var l=s.getModel("ImpIntLPNDataModel").getObject("/")[r];var n=t.getOwnerComponent().getModel("basexsoModel");if(l){var I=s.getItems()[r];t.onPress(I,false);var d=s.getItems()[r];if(e.getSource().getPressed()){t.onPress(d,true)}else{t.onPress(d,false);var g={DURATA_MAX:parseInt(l.DURATA_MAX),DURATA_MAX:parseInt(l.DURATA_MAX),DURATA_MIN:parseInt(l.DURATA_MIN),IDIMPORTIINTERVENTO_LPN:l.IDIMPORTIINTERVENTO_LPN,LIVELLO:l.LIVELLO,MIN_DURATA_MAX:parseInt(l.DURATA_MAX*60),MIN_DURATA_MIN:parseInt(l.DURATA_MIN*60),VALORE:l.VALORE};n.update("/IMPORTIINTERVENTILPN("+l.IDIMPORTIINTERVENTO_LPN+")",g,{success:function(e,o){a.show("Record successfully updated");var s=t.getOwnerComponent().getModel("basexsoModel");t.getImportiInterventiLPNSet(s)}.bind(t),error:function(e){i.error("Impossibile salvare. Contatta l'amministratore")}.bind(t)})}}},onDeleteLPN:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idTableLPNIntData1");var r=s.indexOfItem(o);var l=s.getModel("ImpIntLPNDataModel").getObject("/")[r];var n=t.getOwnerComponent().getModel("basexsoModel");n.remove("/IMPORTIINTERVENTILPN("+l.IDIMPORTIINTERVENTO_LPN+")",{success:function(e,o){a.show("Record successfully deleted");t.getImportiInterventiLPNSet(n)}.bind(t),error:function(e){i.error("Impossibile salvare. Contatta l'amministratore")}.bind(t)})},getImportiRep:function(e){var t=new sap.ui.model.json.JSONModel;var a=this;e.read("/IMPORTIREPERIBILITA",{success:function(e,o){console.log("Data Loded");a.GenID=e.results[e.results.length-1].GenID+1;a.IDIMPORTIREPERIBILITA=e.results[e.results.length-1].IDIMPORTIREPERIBILITA+1;var s=[];var i={};for(var r=0;r<e.results.length;++r){i={GenID:e.results[r].GenID,IDIMPORTIREPERIBILITA:e.results[r].IDIMPORTIREPERIBILITA,GIORNI:e.results[r].GIORNI,IMPORTO:e.results[r].IMPORTO,LIVELLO:e.results[r].LIVELLO,oEdit:true,oDelete:true};s.push(i);i={}}t.setData(s);a.getView().setModel(t,"ImpIntDataImpModel")}.bind(a),error:function(e){console.log("Error")}.bind(a)})},onAddImpIntItemImp:function(e){var t=this;var s=t.getOwnerComponent().getModel("basexsoModel");t.getImportiRep(s);if(t.getView().byId("idTableImpIntDataImp").getModel("ImpIntDataImpModel")===undefined){var r=t.getView().byId("idTableInterLPN1");t.mainData={ImportIInterCollection:[{IDIMPORTIREPERIBILITA:t.IDIMPORTIREPERIBILITA+1,GIORNI:r.getItems()[0].getCells()[0].getSelectedItem().getText(),IMPORTO:r.getItems()[0].getCells()[1].getSelectedItem().getText(),LIVELLO:r.getItems()[0].getCells()[2].getSelectedItem().getText(),oEdit:true,oDelete:true}]};t.ImpIntDataImpModel=new o(t.mainData);t.getView().byId("idTableImpIntDataImp").setModel(t.ImpIntDataImpModel,"ImpIntDataImpModel")}else{var l=t.getView().byId("idTableImpIntDataImp").getModel("ImpIntDataImpModel").getProperty("/");var r=t.getView().byId("idTableImpInvImp");var n={IDIMPORTIREPERIBILITA:t.IDIMPORTIREPERIBILITA+1,GIORNI:r.getItems()[0].getCells()[0].getSelectedKey(),IMPORTO:r.getItems()[0].getCells()[1].getValue(),LIVELLO:r.getItems()[0].getCells()[2].getSelectedKey()};l.push(n);t.getView().byId("idTableImpIntDataImp").getModel("ImpIntDataImpModel").setProperty("/",l);s.create("/IMPORTIREPERIBILITA",n,{success:function(e,o){a.show("Record successfully added");t.getImportiInterventiLPNSet(s)}.bind(t),error:function(e){i.error("Impossibile salvare. Contatta l'amministratore")}.bind(t)})}},onEditImpInt1:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idTableImpIntDataImp");var r=s.indexOfItem(o);var l=s.getModel("ImpIntDataImpModel").getObject("/")[r];var n=t.getOwnerComponent().getModel("basexsoModel");if(l){var I=s.getItems()[r];t.onPress(I,false);var d=s.getItems()[r];if(e.getSource().getPressed()){t.onPress(d,true)}else{t.onPress(d,false);var g={GIORNI:l.GIORNI,IDIMPORTIREPERIBILITA:l.IDIMPORTIREPERIBILITA,IMPORTO:l.IMPORTO,LIVELLO:l.LIVELLO};n.update("/IMPORTIREPERIBILITA("+l.IDIMPORTIREPERIBILITA+")",g,{success:function(e,o){a.show("Record successfully updated");t.getImportiRep(n)}.bind(t),error:function(e){i.error("Impossibile salvare. Contatta l'amministratore")}.bind(t)})}}},onDeleteImpInt1:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idTableImpIntDataImp");var r=s.indexOfItem(o);var l=s.getModel("ImpIntDataImpModel").getObject("/")[r];var n=t.getOwnerComponent().getModel("basexsoModel");n.remove("/IMPORTIREPERIBILITA("+l.IDIMPORTIREPERIBILITA+")",{success:function(e,o){a.show("Record successfully deleted");t.getImportiRep(n)}.bind(t),error:function(e){i.error("Impossibile salvare. Contatta l'amministratore")}.bind(t)})},getRegole:function(e){var t=this;e.read("/REGOLECOMPENSATIVI",{success:function(e,a){console.log("Data Loded");var o=new sap.ui.model.json.JSONModel(e.results);t.getView().byId("idTableRegoleCompen").setModel(o,"oRegoleModel")},error:function(e){console.log("Error")}})},onCancelRegoleItem:function(e){var t=this;t.Modify="";this.byId("idTipoCollectionImp7").setSelectedKey("");this.byId("TPOrainizio").setValue("");this.byId("idOraInizioIn").setSelectedKey("");this.byId("TPOraFine").setValue("");this.byId("idOraFineIn").setSelectedKey("");this.byId("idDurataMinima1").setValue("");this.byId("iddurataMinimaIn").setSelectedKey("");this.byId("idDurataMassima1").setValue("");this.byId("iddurataMassimaIn").setSelectedKey("");this.byId("idInclusioneDurataIn").setValue("");this.byId("idDurataRiposoIn").setValue("")},onAddRegoleItem:function(e){debugger;var t=this;var o=this.byId("TPOrainizio").getValue().split(":");var s=o[0]+":"+o[1]+":"+"00";var r=this.byId("TPOraFine").getValue().split(":");var l=r[0]+":"+r[1]+":"+"00";if(!t.Modify){var n={GIORNI:parseInt(this.byId("idTipoCollectionImp7").getSelectedKey()),FASCIA_INIZIO:s,INCLUSO_FI:parseInt(this.byId("idOraInizioIn").getSelectedKey()),FASCIA_FINE:l,INCLUSO_FF:parseInt(this.byId("idOraFineIn").getSelectedKey()),DURATA_MIN:parseInt(this.byId("idDurataMinima1").getSelectedKey()*60),INCLUSO_DMIN:parseInt(this.byId("iddurataMinimaIn").getSelectedKey()),DURATA_MAX:parseInt(this.byId("idDurataMassima1").getSelectedKey()*60),INCLUSO_DMAX:parseInt(this.byId("iddurataMassimaIn").getSelectedKey()),DURATA_INCLUSA:parseInt(this.byId("idInclusioneDurataIn").getSelectedKey()),VALORE:this.byId("idDurataRiposoIn").getSelectedKey(),TIPO_COMPENSATIVO:0,DACONTRATTO:1};var I=t.getOwnerComponent().getModel("basexsoModel");debugger;var d=JSON.stringify(n);var t=this;var g="/HANAMDC/REPINT/RepintAdmin/xsjs/insertREGOLECOMPENSATIVI.xsjs";jQuery.ajax({url:g,async:false,TYPE:"POST",data:{dataobject:d},method:"GET",dataType:"text",success:function(e){if(JSON.parse(e).result=="Success"){a.show("Record successfully added");t.getRegole(I);t.onCancelRegoleItem()}else{i.error("Aggiungi failed. Please contact administrator.")}}.bind(this),error:function(e){i.error("Aggiungi failed. Please contact administrator.")}})}else{var t=this;var c=this.byId("TPOrainizio").getValue().split(":");var u="PT"+c[0]+"H"+c[1]+"M";var m=this.byId("TPOraFine").getValue().split(":");var M="PT"+m[0]+"H"+m[1]+"M";debugger;var D={GIORNI:parseInt(this.byId("idTipoCollectionImp7").getSelectedKey()),FASCIA_INIZIO:u,INCLUSO_FI:parseInt(this.byId("idOraInizioIn").getSelectedKey()),FASCIA_FINE:M,INCLUSO_FF:parseInt(this.byId("idOraFineIn").getSelectedKey()),DURATA_MIN:parseInt(this.byId("idDurataMinima1").getSelectedKey()*60),INCLUSO_DMIN:parseInt(this.byId("iddurataMinimaIn").getSelectedKey()),DURATA_MAX:parseInt(this.byId("idDurataMassima1").getSelectedKey()*60),INCLUSO_DMAX:parseInt(this.byId("iddurataMassimaIn").getSelectedKey()),DURATA_INCLUSA:parseInt(this.byId("idInclusioneDurataIn").getSelectedKey()),VALORE:this.byId("idDurataRiposoIn").getSelectedKey()};var I=t.getOwnerComponent().getModel("basexsoModel");I.update("/REGOLECOMPENSATIVI("+t.IDREGOLA+")",D,{success:function(e,o){a.show("Record successfully Modified");t.Modify="";t.getRegole(I);t.onCancelRegoleItem()}.bind(t),error:function(e){i.error("Aggiungi failed. Please contact administrator.");t.Modify=""}.bind(t)})}},onDeleteRegole:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idTableRegoleCompen");var r=s.indexOfItem(o);var l=s.getModel("oRegoleModel").getObject("/")[r];var n=t.getOwnerComponent().getModel("basexsoModel");n.remove("/REGOLECOMPENSATIVI("+l.IDREGOLA+")",{success:function(e,o){a.show("Record successfully Deleted");t.getRegole(n)}.bind(t),error:function(e){i.error("Deletion failed. Please contact administrator.")}.bind(t)})},onEditRegole:function(e){var t=this;var a=e.getSource().getParent();var o=t.getView().byId("idTableRegoleCompen");var s=o.indexOfItem(a);var i=o.getModel("oRegoleModel").getObject("/")[s];var r=parseInt(i.FASCIA_INIZIO.ms/3600);var l=i.FASCIA_INIZIO.ms%3600/60;var n=r+":"+l;var I=parseInt(i.FASCIA_FINE.ms/3600);var d=i.FASCIA_FINE.ms%3600/60;var g=I+":"+d;t.Modify="X";t.IDREGOLA=i.IDREGOLA;t.byId("idTipoCollectionImp7").setSelectedKey(i.GIORNI);t.byId("TPOrainizio").setValue(n);t.byId("idOraInizioIn").setSelectedKey(i.INCLUSO_FI);t.byId("TPOraFine").setValue(g);t.byId("idOraFineIn").setSelectedKey(i.INCLUSO_FF);t.byId("idDurataMinima1").setSelectedKey(i.DURATA_MIN/60);t.byId("iddurataMinimaIn").setSelectedKey(i.INCLUSO_DMIN);t.byId("idDurataMassima1").setSelectedKey(i.DURATA_MAX/60);t.byId("iddurataMassimaIn").setSelectedKey(i.INCLUSO_DMAX);t.byId("idInclusioneDurataIn").setSelectedKey(i.DURATA_INCLUSA);t.byId("idDurataRiposoIn").setSelectedKey(i.VALORE)},onAddRogoleBlocco:function(e){var t={};var o=[];var s=this.getView().getModel("oRogoleBloccoModel").getData();if(!s)a.show("Please enter Value");else{if(this.getView().byId("idCheckboxAttivo").getSelected()==true)t.ATTIVO=1;else t.ATTIVO=0;t.LIVELLO=this.getView().byId("idLivelloRegoleBlocco").getSelectedKey();t.DATAINIZIO=d.getDateInstance({pattern:"yyyy-MM-dd",UTC:"true"}).format(new Date(s.DATAINIZIO));t.DATAFINE=d.getDateInstance({pattern:"yyyy-MM-dd",UTC:"true"}).format(new Date(s.DATAFINE));if(!s.IMPORTOMAX)s.IMPORTOMAX=0;if(!s.GIORNIMAX)s.GIORNIMAX=0;var r={ATTIVO:t.ATTIVO,LIVELLO:t.LIVELLO,DATAINIZIO:t.DATAINIZIO,DATAFINE:t.DATAFINE,IMPORTOMAX:s.IMPORTOMAX,GIORNIMAX:s.GIORNIMAX};var l=JSON.stringify(r);var n=this;var I="/HANAMDC/REPINT/RepintAdmin/xsjs/insertRegoleBlocco.xsjs";jQuery.ajax({url:I,async:false,TYPE:"POST",data:{dataobject:l},method:"GET",dataType:"text",success:function(e){if(JSON.parse(e).result=="Success"){this.getRegoleBlocco();a.show("Record successfully added")}else{i.error("Aggiungi failed. Please contact administrator.")}}.bind(this),error:function(e){i.error("Aggiungi failed. Please contact administrator.")}})}},getRegoleBlocco:function(e){var e=this.getOwnerComponent().getModel("basexsoModel");var t=new o;var a=this;a._busyDialog.open();e.read("/T_REGOLEBLOCCO",{success:function(e,o){var s=[];var i={};for(var r=0;r<e.results.length;++r){i={IDREGOLEBLOCCO:e.results[r].IDREGOLEBLOCCO,ATTIVO:e.results[r].ATTIVO,LIVELLO:e.results[r].LIVELLO,DATAINIZIO:e.results[r].DATAINIZIO,DATAFINE:e.results[r].DATAFINE,IMPORTOMAX:e.results[r].IMPORTOMAX,GIORNIMAX:e.results[r].GIORNIMAX,oEdit:true,oDelete:true};s.push(i);i={}}t.setData(s);a.getView().setModel(t,"rogoleBloccoDataItems");a.getView().getModel("rogoleBloccoDataItems").refresh();a._busyDialog.close()}.bind(a),error:function(e){console.log("Error");a._busyDialog.close()}.bind(a)})},onAttivoCheckboxSelect:function(e){var t=e.getSource().getBindingContext("rogoleBloccoDataItems").sPath.substr(1);var a=this.getView().byId("idTableDataRegoleBlocco").getModel("rogoleBloccoDataItems");if(e.getParameter("selected")==true)a.getData()[t].ATTIVO=1;else a.getData()[t].ATTIVO=0},onEditRogoleBlocco:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idTableDataRegoleBlocco");var r=s.indexOfItem(o);var l=s.getModel("rogoleBloccoDataItems").getData()[r];var n=t.getOwnerComponent().getModel("basexsoModel");if(l){var I=s.getItems()[r];t.onPress(I,false);var d=s.getItems()[r];if(e.getSource().getPressed()){t.onPress(d,true)}else{t.onPress(d,false);l.DATAINIZIO=new Date(l.DATAINIZIO);l.DATAFINE=new Date(l.DATAFINE);var g={ATTIVO:l.ATTIVO,LIVELLO:l.LIVELLO,DATAINIZIO:l.DATAINIZIO,DATAFINE:l.DATAFINE,IMPORTOMAX:l.IMPORTOMAX,GIORNIMAX:l.GIORNIMAX};n.update("/T_REGOLEBLOCCO("+l.IDREGOLEBLOCCO+")",g,{success:function(e,o){a.show("Record successfully updated");t.getRegoleBlocco()}.bind(t),error:function(e){i.error("Modifica failed for Regole Blocco. Please contact administrator.")}.bind(t)})}}},onDeleteRogoleBlocco:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idTableDataRegoleBlocco");var r=s.indexOfItem(o);var l=s.getModel("rogoleBloccoDataItems").getObject("/")[r];var n=t.getOwnerComponent().getModel("basexsoModel");n.remove("/T_REGOLEBLOCCO("+l.IDREGOLEBLOCCO+")",{success:function(e,o){a.show("Record successfully deleted");t.getRegoleBlocco()}.bind(t),error:function(e){i.error("Deletion failed for Rogole Blocco. Please contact administrator.")}.bind(t)})},onPrintRegoleCompensativeMultipli:function(e){window.print()},onModifyRegoleCompensativeMultipli:function(e){var t=this;var o=e.getSource().getParent();var s=t.getView().byId("idRegoleCompensativeMultipli");var r=s.indexOfItem(o);var l=s.getModel("oRegoleCompensativeMultipliModel").getData()[r];var n=t.getOwnerComponent().getModel("basexsoModel");if(l){var I=s.getItems()[r];t.onPressregoleCompensativeMulti(I,false);var d=s.getItems()[r];if(e.getSource().getPressed()){t.onPressregoleCompensativeMulti(d,true)}else{t.onPressregoleCompensativeMulti(d,false);var g=[];var s=l.FASCIA_INIZIO;g=s.split(":");l.FASCIA_INIZIO="PT"+g[0]+"H"+g[1]+"M";var c=[];var u=l.FASCIA_FINE;c=u.split(":");l.FASCIA_FINE="PT"+c[0]+"H"+c[1]+"M";var m={N_INTERVENTI:l.N_INTERVENTI,VALORE:l.VALORE,FASCIA_INIZIO:l.FASCIA_INIZIO,FASCIA_FINE:l.FASCIA_FINE};n.update("/T_REGOLECOMPENSATIVIMULTI("+l.IDREGOLECOMPENSATIVIMULTI+")",m,{success:function(e,o){a.show("Record successfully updated");t.getRegoleCompensativeMultipli()}.bind(t),error:function(e){i.error("Modifica failed for Regole compensative multipli. Please contact administrator.")}.bind(t)})}}},getRegoleCompensativeMultipli:function(e){var t=this.getOwnerComponent().getModel("basexsoModel");var a=new o;var s=this;s._busyDialog.open();t.read("/T_REGOLECOMPENSATIVIMULTI",{success:function(e,t){var o=[];var i={};for(var r=0;r<e.results.length;r++){var l=(e.results[r].FASCIA_INIZIO.ms/(1e3*60*60)%24).toString().split(".");if(l[0]<=9)l[0]="0"+l[0];var n=e.results[r].FASCIA_INIZIO.ms/(1e3*60)%60;if(n<=9)n="0"+n;var I=l[0]+":"+n;var l=(e.results[r].FASCIA_FINE.ms/(1e3*60*60)%24).toString().split(".");if(l[0]<=9)l[0]="0"+l[0];var n=e.results[r].FASCIA_FINE.ms/(1e3*60)%60;if(n<=9)n="0"+n;var d=l[0]+":"+n;i={IDREGOLECOMPENSATIVIMULTI:e.results[r].IDREGOLECOMPENSATIVIMULTI,N_INTERVENTI:e.results[r].N_INTERVENTI,VALORE:e.results[r].VALORE,FASCIA_INIZIO:I,FASCIA_FINE:d,oEdit:true};o.push(i);i={}}a.setData(o);s.getView().setModel(a,"oRegoleCompensativeMultipliModel");s.getView().getModel("oRegoleCompensativeMultipliModel").refresh();s._busyDialog.close()}.bind(s),error:function(e){console.log("Error");s._busyDialog.close()}.bind(s)})},onPressregoleCompensativeMulti:function(e,t){var a=e.getCells();for(var o=0;o<a.length-1;o++){var s=a[o];var i=s.getMetadata();var r=i.getElementName();if(r==="sap.m.Input"||r==="sap.m.TimePicker"){s.setEnabled(t);s.setEditable(t)}}}})});